<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Гіт-Оркестратор: Ваш Провідник у Git та GitHub</title>
    <style>
        /* CSS залишається майже без змін, як у вашому останньому прикладі */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }

        header {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        h1, h2 {
            color: #2c3e50;
        }

        h3 {
            color: #34495e;
        }

        p {
            margin-bottom: 15px;
        }

        .content-section, .info-section {
            background-color: #ffffff;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        /* --- Стилі для попапу "Оркестратор" --- */
        .orchestrator-popup {
            display: none;
            opacity: 0;
            visibility: hidden;

            position: absolute;
            z-index: 1000;

            background-color: #ffffff;
            border: 1px solid #c0c0c0;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 280px;
            min-width: 250px;
            padding: 15px;
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
            box-sizing: border-box;
        }

        .popup-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .popup-icon {
            font-size: 1.4em;
            margin-right: 8px;
            color: #2e78c0;
        }

        .popup-title {
            margin: 0;
            font-size: 1.1em;
            color: #333;
            flex-grow: 1;
        }

        .popup-close-btn {
            background: none;
            border: none;
            font-size: 1.6em;
            cursor: pointer;
            color: #999;
            padding: 0 5px;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .popup-close-btn:hover {
            color: #ff6347;
        }

        .popup-content {
            margin-bottom: 10px;
        }

        .popup-section {
            margin-bottom: 12px;
        }

        .section-label {
            font-weight: bold;
            color: #444;
            margin-bottom: 4px;
            font-size: 0.9em;
        }

        .popup-description {
            font-size: 0.95em;
            margin-bottom: 8px;
            color: #555;
        }

        .popup-actions-resources {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .popup-actions-resources a {
            display: block;
            color: white;
            padding: 7px 10px;
            text-align: center;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.85em;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        /* Стиль для посилань на ШІ та Загальний Пошук */
        .popup-actions-resources a.ai-search-link {
            background-color: #5bb7f2;
        }

        .popup-actions-resources a.ai-search-link:hover {
            background-color: #419edb;
            transform: translateY(-1px);
        }

        /* Стиль для посилань на Релевантні Ресурси та Конкретні Дії/Сервіси */
        .popup-actions-resources a.action-resource-link {
            background-color: #2e78c0;
        }

        .popup-actions-resources a.action-resource-link:hover {
            background-color: #225a91;
            transform: translateY(-1px);
        }

        .popup-footer {
            border-top: 1px solid #e0e0e0;
            padding-top: 8px;
            text-align: center;
        }

        .customization-message {
            font-size: 0.7em;
            color: #888;
            line-height: 1.2;
            margin: 0;
        }

        /* Стилі для повідомлення про відсутність інформації */
        .not-found-message {
            background-color: #e6ffe6; /* Світло-зелений фон */
            border: 1px solid #66bb6a; /* Зелена рамка */
            color: #388e3c; /* Темно-зелений текст */
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 0.9em;
            text-align: left;
            line-height: 1.4;
        }

        /* Стилі для адаптивності (на менших екранах) */
        @media (max-width: 600px) {
            .orchestrator-popup {
                max-width: 90%;
                left: 5% !important;
                right: 5% !important;
                transform: none !important;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Гіт-Оркестратор: Ваш Провідник у Git та GitHub</h1>
        <p>Розкрийте секрети Git та GitHub крок за кроком, отримуючи миттєві підказки.</p>
    </header>

    <main>
        <section class="content-section">
            <h2>Розділ 1: Початок Подорожі – Ваша Цифрова Ідентичність</h2>
            <p>
                Уявіть, що світ коду — це безмежний океан, а ви — сміливий мореплавець. Ваша подорож починається з народження в цьому світі, тобто з **реєстрації** на платформі **GitHub**. Це момент, коли ви заявляєте про себе, ставлячи свій особистий підпис на великій, величній книзі історії розробки. З цього моменту кожен ваш внесок, кожен проєкт стає частиною вашої особистої розповіді, вашого професійного щоденника.
            </p>
            <p>
                Тепер, коли ви маєте своє ім'я на карті, настав час звести свою власну "виставкову залу" – **репозиторій**. Це ваше особисте сховище, де ви будете експонувати свої творіння: фрагменти коду, документи, ідеї, що оживають.
            </p>
        </section>

        <section class="content-section">
            <h2>Розділ 2: Майстерня на Вашому Столі – Локальна Робота</h2>
            <p>
                Справжня магія, основна робота, відбувається у вашій "приватній майстерні" — на **локальному ПК**. Тут, за допомогою **командного рядка**, ви творите, виправляєте, вдосконалюєте. Кожна команда, яку ви вводите, це мовлення до вашого проекту. Наприклад, щоб розпочати роботу над новим проектом, ви можете його **ініціалізувати** або **клонувати** вже існуючий.
            </p>
            <p>
                Коли ви завершили певний етап роботи, ви робите "знімок" поточного стану свого проекту – це операція **commit**. Це як зробити фотографію вашої роботи, щоб ви завжди могли повернутися до цього моменту, якщо щось піде не так. Перед комітом ви можете перевірити **статус** своїх змін і додати файли до "сцени" за допомогою **git add**.
            </p>
        </section>

        <section class="content-section">
            <h2>Розділ 3: Синхронізація Світів – Взаємодія з GitHub</h2>
            <p>
                Тепер, коли ваші творіння на **локальному ПК** готові, настав час показати їх світу, або принаймні синхронізувати з вашою "виставковою залою" на **GitHub**. Цей танець між вашою локальною майстернею та віддаленим сервером GitHub є ключовим для командної роботи та резервного копіювання.
            </p>
            <p>
                Щоб відправити свої зміни з локального комп'ютера на **GitHub**, ви використовуєте команду **git push**. Якщо ж ви хочете отримати найновіші версії від інших розробників або з віддаленого репозиторію, вам знадобиться **git pull**. Це забезпечує, що всі працюють з найактуальнішою версією проекту.
            </p>
        </section>

        <section class="content-section">
            <h2>Розділ 4: Виклики та Рішення – Подолання Перешкод</h2>
            <p>
                У будь-якій подорожі бувають виклики. Іноді ви можете натрапити на "розбиту вазу" або "неправильно змішані фарби" – це **помилки**. Типові ситуації включають: **не git репозиторій**, **репозиторій не знайдено**, **Updates were rejected**, та найчастіше – **конфлікти злиття**. Кожен виклик – це можливість стати сильнішим, і наш Гіт-Оркестратор допоможе вам знайти рішення.
            </p>
            <p>
                Розуміння, чому виникла помилка, є першим кроком до її вирішення. Наприклад, помилка **"не git репозиторій"** означає, що ви намагаєтесь виконати Git-команду в папці, яка не є Git-репозиторієм. Кожна помилка має своє пояснення та шлях до виправлення.
            </p>
        </section>
    </main>

    <div id="orchestrator-popup" class="orchestrator-popup">
        <div class="popup-header">
            <span class="popup-icon">💡</span>
            <h3 class="popup-title"></h3>
            <button class="popup-close-btn">&times;</button>
        </div>
        <div class="popup-content">
            <div class="popup-section">
                <p class="section-label">**1. Суть:**</p>
                <p class="popup-description"></p>
            </div>
            <div class="popup-section">
                <p class="section-label">**2. Дії & Ресурси:**</p>
                <div class="popup-actions-resources">
                    </div>
            </div>
            <div class="not-found-message" style="display: none;">
                <p>⚠️ Цей термін поки що не в нашій базі знань.</p>
                <p>Ви можете:</p>
                <ul>
                    <li><a class="ai-search-link" href="#" target="_blank" data-ai-query="">Запитати Gemini про ""</a></li>
                    <li><a class="ai-search-link" href="#" target="_blank" data-google-query="">Шукати в Google про ""</a></li>
                </ul>
            </div>
        </div>
        <div class="popup-footer">
            <p class="customization-message">
                _Це приклад організації інформації. Ви можете<br>
                _організувати таку систему самостійно чи замовити<br>
                _персоналізацію.
            </p>
        </div>
    </div>

    <script defer>
document.addEventListener('DOMContentLoaded', () => {
    // 1. Посилання на елементи DOM
    const orchestratorPopup = document.getElementById('orchestrator-popup');
    const popupTitle = orchestratorPopup.querySelector('.popup-title');
    const popupDescription = orchestratorPopup.querySelector('.popup-description');
    const popupActionsResources = orchestratorPopup.querySelector('.popup-actions-resources');
    const popupCloseBtn = orchestratorPopup.querySelector('.popup-close-btn');
    const notFoundMessage = orchestratorPopup.querySelector('.not-found-message');
    const notFoundGeminiLink = notFoundMessage.querySelector('[data-ai-query]');
    const notFoundGoogleLink = notFoundMessage.querySelector('[data-google-query]');

    // 2. "База Знань" - наш локальний сховище даних для Git/GitHub
    const knowledgeBase = {
        // --- Розділ 1: Початок Подорожі (Онлайн) ---
        "github": {
            суть: "GitHub – це провідна веб-платформа для хостингу IT-проектів та спільної розробки, що базується на системі контролю версій Git.",
            ресурси: [
                { тип: "action_resource", текст: "Офіційний сайт GitHub", посилання: "https://github.com/", newTab: true },
                { тип: "action_resource", текст: "Що таке GitHub? (Документація)", посилання: "https://docs.github.com/en/get-started/onboarding/what-is-github", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Для чого потрібен GitHub?'", запит: "Для чого потрібен GitHub?" }
            ]
        },
        "реєстрація": { // Змінив на однину для уніфікації
            суть: "Реєстрація на GitHub – це створення вашого особистого профілю, який стане вашою цифровою ідентичністю у світі розробки.",
            ресурси: [
                { тип: "action_resource", текст: "Сторінка реєстрації на GitHub", посилання: "https://github.com/join", newTab: true },
                { тип: "action_resource", текст: "Посібник: Як зареєструватися на GitHub", посилання: "https://docs.github.com/en/get-started/onboarding/signing-up-for-github", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Перші кроки після реєстрації на GitHub'", запит: "Перші кроки після реєстрації на GitHub" }
            ]
        },
        "репозиторій": {
            суть: "Репозиторій (repo) – це основна одиниця зберігання проекту на GitHub. Це сховище для всіх файлів проекту, історії змін та спільної роботи.",
            ресурси: [
                { тип: "action_resource", текст: "Створення нового репозиторію на GitHub", посилання: "https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-new-repository", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Що зберігається в Git репозиторії?'", запит: "Що зберігається в Git репозиторії?" }
            ]
        },
        // --- Розділ 2: Майстерня на Вашому Столі (Локальний ПК) ---
        "локальний пк": { // Змінив на однину для уніфікації
            суть: "Локальний ПК – це ваш персональний комп'ютер, на якому ви безпосередньо працюєте з файлами проекту та системою Git перед синхронізацією з GitHub.",
            ресурси: [
                { тип: "action_resource", текст: "Встановлення Git на ваш ПК", посилання: "https://git-scm.com/book/uk/v2/%D0%9F%D0%BE%D1%87%D0%B0%D1%82%D0%BE%D0%BA-%D1%80%D0%BE%D0%B1%D0%BE%D1%82%D0%B8-%D0%92%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%BD%D1%8F-Git", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Навіщо потрібен Git на локальному комп'ютері?'", запит: "Навіщо потрібен Git на локальному комп'ютері?" }
            ]
        },
        "командний рядок": { // Змінив на однину для уніфікації
            суть: "Командний рядок (термінал) – це текстовий інтерфейс для взаємодії з операційною системою та Git, дозволяючи вводити команди напряму.",
            ресурси: [
                { тип: "action_resource", текст: "Основи роботи з командним рядком", посилання: "https://www.codecademy.com/learn/learn-the-command-line/modules/command-line-navigation", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Основні команди терміналу для початківців'", запит: "Основні команди терміналу для початківців" }
            ]
        },
        "ініціалізувати": {
            суть: "Ініціалізація (git init) – це створення нового пустого Git-репозиторію у поточній директорії, що дозволяє Git відстежувати зміни у файлах.",
            ресурси: [
                { тип: "action_resource", текст: "Команда `git init`", посилання: "https://git-scm.com/docs/git-init", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Коли використовувати git init?'", запит: "Коли використовувати git init?" }
            ],
            блок_оркестратора: "команди git"
        },
        "клонувати": {
            суть: "Клонування (git clone) – це копіювання існуючого Git-репозиторію з віддаленого сервера (наприклад, GitHub) на ваш локальний комп'ютер.",
            ресурси: [
                { тип: "action_resource", текст: "Команда `git clone`", посилання: "https://git-scm.com/docs/git-clone", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Різниця між git clone та git init'", запит: "Різниця між git clone та git init" }
            ],
            блок_оркестратора: "команди git"
        },
        "commit": {
            суть: "Коміт (git commit) – це 'знімок' змін у вашому локальному репозиторії. Кожен коміт фіксує певний стан проекту з описовим повідомленням.",
            ресурси: [
                { тип: "action_resource", текст: "Команда `git commit`", посилання: "https://git-scm.com/docs/git-commit", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Як писати хороші коміт-повідомлення?'", запит: "Як писати хороші коміт-повідомлення?" }
            ],
            блок_оркестратора: "команди git"
        },
        "статус": {
            суть: "Статус (git status) – команда, яка показує поточний стан вашого робочого каталогу та індексного файлу, відображаючи змінені, staged та untracked файли.",
            ресурси: [
                { тип: "action_resource", текст: "Команда `git status`", посилання: "https://git-scm.com/docs/git-status", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Що означає 'untracked files' у git status?'", запит: "Що означає 'untracked files' у git status?" }
            ],
            блок_оркестратора: "команди git"
        },
        "git add": {
            суть: "Команда `git add` додає зміни з робочого каталогу до 'staging area' (індексу), готуючи їх до наступного коміту.",
            ресурси: [
                { тип: "action_resource", текст: "Команда `git add`", посилання: "https://git-scm.com/docs/git-add", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Навіщо потрібен git add перед commit?'", запит: "Навіщо потрібен git add перед commit?" }
            ],
            блок_оркестратора: "команди git"
        },
        // --- Розділ 3: Синхронізація Світів ---
        "git push": {
            суть: "Команда `git push` відправляє ваші локальні коміти з локального репозиторію на віддалений репозиторій (наприклад, на GitHub).",
            ресурси: [
                { тип: "action_resource", текст: "Команда `git push`", посилання: "https://git-scm.com/docs/git-push", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Коли використовувати git push force?'", запит: "Коли використовувати git push force?" }
            ],
            блок_оркестратора: "взаємодія локальний пк - github"
        },
        "git pull": {
            суть: "Команда `git pull` завантажує останні зміни з віддаленого репозиторію та автоматично зливає їх з вашою поточною локальною гілкою.",
            ресурси: [
                { тип: "action_resource", текст: "Команда `git pull`", посилання: "https://git-scm.com/docs/git-pull", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Різниця між git pull та git fetch'", запит: "Різниця між git pull та git fetch" }
            ],
            блок_оркестратора: "взаємодія локальний пк - github"
        },
        "взаємодія локальний пк - github": {
            суть: "Оркестратор, що охоплює основні команди та концепції для обміну даними між вашим локальним комп'ютером та GitHub.",
            ресурси: [
                { тип: "action_resource", текст: "Детальніше про `git push`", посилання: "https://git-scm.com/docs/git-push", newTab: true },
                { тип: "action_resource", текст: "Детальніше про `git pull`", посилання: "https://git-scm.com/docs/git-pull", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Синхронізація локального Git з GitHub'", запит: "Синхронізація локального Git з GitHub" }
            ]
        },
        // --- Розділ 4: Виклики та Рішення (Помилки) ---
        "помилки": {
            суть: "Огляд найпоширеніших помилок у Git та GitHub, а також шляхи їх діагностики та вирішення.",
            ресурси: [
                { тип: "action_resource", текст: "Fatal: Not a Git Repository (Рішення)", посилання: "https://www.git-tower.com/learn/git/faq/not-a-git-repository-error", newTab: true },
                { тип: "action_resource", текст: "Merge Conflicts (Рішення)", посилання: "https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts/resolving-a-merge-conflict-on-github", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Найпоширеніші помилки Git та як їх виправити'", запит: "Найпоширеніші помилки Git та як їх виправити" }
            ],
            блок_оркестратора: "помилки git і github"
        },
        "не git репозиторій": {
            суть: "Помилка 'fatal: not a git repository' означає, що ви намагаєтеся виконати Git-команду в папці, яка не є ініціалізованим Git-репозиторієм.",
            ресурси: [
                { тип: "action_resource", текст: "Рішення: Fatal: Not a Git Repository", посилання: "https://www.git-tower.com/learn/git/faq/not-a-git-repository-error", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Як ініціалізувати Git репозиторій?'", запит: "Як ініціалізувати Git репозиторій?" }
            ],
            блок_оркестратора: "помилки git і github"
        },
        "репозиторій не знайдено": {
            суть: "Помилка 'fatal: repository '...' not found' вказує на те, що Git не може знайти вказаний віддалений репозиторій, або у вас відсутні права доступу.",
            ресурси: [
                { тип: "action_resource", текст: "Рішення: Repository not found", посилання: "https://docs.github.com/en/authentication/troubleshooting-authentication/error-repository-not-found", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Проблеми з доступом до GitHub репозиторію'", запит: "Проблеми з доступом до GitHub репозиторію" }
            ],
            блок_оркестратора: "помилки git і github"
        },
        "updates were rejected": {
            суть: "Помилка 'Updates were rejected' виникає, коли ваші локальні зміни конфліктують з останніми змінами на віддаленому репозиторії. Зазвичай потрібно спочатку оновити локальну копію (`git pull`).",
            ресурси: [
                { тип: "action_resource", текст: "Рішення: Updates were rejected", посилання: "https://www.git-tower.com/learn/git/faq/updates-were-rejected", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Як вирішити 'updates were rejected'?'", запит: "Як вирішити 'updates were rejected'?" }
            ],
            блок_оркестратора: "помилки git і github"
        },
        "конфлікти злиття": {
            суть: "Конфлікт злиття (merge conflict) виникає, коли Git не може автоматично об'єднати зміни з різних гілок через конкуруючі правки в одному і тому ж файлі. Це вимагає ручного вирішення.",
            ресурси: [
                { тип: "action_resource", текст: "Рішення: Merge conflict in file", посилання: "https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts/resolving-a-merge-conflict-on-github", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Покрокове вирішення merge conflict'", запит: "Покрокове вирішення merge conflict" }
            ],
            блок_оркестратора: "помилки git і github"
        },
        "помилки git і github": {
            суть: "Оркестратор, що зібрав найпоширеніші виклики та їхні рішення у роботі з Git та GitHub.",
            ресурси: [
                { тип: "action_resource", текст: "Всі помилки Git (офіційна документація)", посилання: "https://git-scm.com/docs/", newTab: true },
                { тип: "action_resource", текст: "Типові помилки GitHub (документація)", посилання: "https://docs.github.com/en/authentication/troubleshooting-authentication/troubleshooting-ssh", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Найчастіші проблеми з Git та GitHub'", запит: "Найчастіші проблеми з Git та GitHub" }
            ]
        },
        "команди git": {
            суть: "Оркестратор, що містить основні команди Git для контролю версій та керування проектами.",
            ресурси: [
                { тип: "action_resource", текст: "Довідник по командам Git", посилання: "https://git-scm.com/docs/", newTab: true },
                { тип: "ai_search", текст: "Запитати Gemini: 'Шпаргалка по командам Git'", запит: "Шпаргалка по командам Git" },
                { тип: "action_resource", текст: "Детальніше про `git init`", посилання: "https://git-scm.com/docs/git-init", newTab: true },
                { тип: "action_resource", текст: "Детальніше про `git clone`", посилання: "https://git-scm.com/docs/git-clone", newTab: true },
                { тип: "action_resource", текст: "Детальніше про `git status`", посилання: "https://git-scm.com/docs/git-status", newTab: true },
                { тип: "action_resource", текст: "Детальніше про `git add`", посилання: "https://git-scm.com/docs/git-add", newTab: true },
                { тип: "action_resource", текст: "Детальніше про `git commit`", посилання: "https://git-scm.com/docs/git-commit", newTab: true }
            ]
        }
    };

    // Функція для відображення попапу з даними
    function showOrchestratorPopup(term, selectionCoords) {
        let data = knowledgeBase[term]; 
        let isExactMatch = !!data; // Прапорець, чи є точне співпадіння

        // Якщо точного співпадіння немає, спробуємо знайти за підрядком
        if (!data) {
            for (const key in knowledgeBase) {
                if (key.length > 2 && (term.includes(key) || key.includes(term))) {
                    data = knowledgeBase[key];
                    // Використовуємо оригінальний виділений термін для заголовка,
                    // але дані беремо з знайденого ключа knowledgeBase
                    popupTitle.textContent = term.charAt(0).toUpperCase() + term.slice(1);
                    break;
                }
            }
        }
        
        // Якщо все одно немає даних, показуємо повідомлення "не знайдено"
        if (!data) {
            popupTitle.textContent = selectedTextForNotFound.charAt(0).toUpperCase() + selectedTextForNotFound.slice(1);
            popupDescription.textContent = "На жаль, інформації за цим терміном наразі немає в нашій базі знань.";
            popupActionsResources.innerHTML = ''; // Очищаємо всі кнопки
            notFoundMessage.style.display = 'block'; // Показуємо повідомлення
            notFoundGeminiLink.href = `https://gemini.google.com/search?q=${encodeURIComponent(selectedTextForNotFound)}`;
            notFoundGeminiLink.textContent = `Запитати Gemini про "${selectedTextForNotFound}"`;
            notFoundGoogleLink.href = `https://www.google.com/search?q=${encodeURIComponent(selectedTextForNotFound)}`;
            notFoundGoogleLink.textContent = `Шукати в Google про "${selectedTextForNotFound}"`;
        } else {
            // Якщо дані є, приховуємо повідомлення "не знайдено" та заповнюємо попап
            notFoundMessage.style.display = 'none';
            if (isExactMatch) { // Якщо було точне співпадіння, використовуємо його для заголовка
                popupTitle.textContent = term.charAt(0).toUpperCase() + term.slice(1);
            }
            popupDescription.textContent = data.суть; 
            popupActionsResources.innerHTML = ''; 

            data.ресурси.forEach(resource => {
                const link = document.createElement('a');
                link.textContent = resource.текст;
                link.classList.add(resource.тип === 'ai_search' ? 'ai-search-link' : 'action-resource-link');

                if (resource.тип === 'ai_search') {
                    if (resource.текст.includes('Gemini')) {
                        link.href = `https://gemini.google.com/search?q=${encodeURIComponent(resource.запит)}`;
                    } else { 
                        link.href = `https://www.google.com/search?q=${encodeURIComponent(resource.запит)}`;
                    }
                    link.target = "_blank";
                } else { 
                    link.href = resource.посилання;
                    if (resource.newTab) {
                        link.target = "_blank";
                    } else {
                        link.target = "_self";
                    }
                }
                popupActionsResources.appendChild(link);
            });

            if (data.блок_оркестратора) {
                const blockLink = document.createElement('a');
                blockLink.textContent = `🚀 Детальніше про ${data.блок_оркестратора.charAt(0).toUpperCase() + data.блок_оркестратора.slice(1)}`;
                blockLink.href = "#"; 
                blockLink.classList.add('action-resource-link');
                blockLink.addEventListener('click', (e) => {
                    e.preventDefault(); 
                    showOrchestratorPopup(data.блок_оркестратора.toLowerCase(), selectionCoords); 
                });
                popupActionsResources.appendChild(blockLink);
            }
        }

        orchestratorPopup.style.display = 'block'; 
        orchestratorPopup.style.visibility = 'hidden';

        const popupWidth = orchestratorPopup.offsetWidth;
        const popupHeight = orchestratorPopup.offsetHeight;
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        const scrollX = window.scrollX || window.pageXOffset;
        const scrollY = window.scrollY || window.pageYOffset;

        let left = selectionCoords.left + scrollX;
        let top = selectionCoords.bottom + scrollY + 10; 

        if (left + popupWidth > viewportWidth + scrollX) {
            left = viewportWidth + scrollX - popupWidth - 10; 
            if (left < scrollX) left = scrollX + 10; 
        }

        if (top + popupHeight > viewportHeight + scrollY) {
            top = selectionCoords.top + scrollY - popupHeight - 10;
            if (top < scrollY) { 
                top = selectionCoords.bottom + scrollY + 10;
            }
        }

        orchestratorPopup.style.left = `${left}px`;
        orchestratorPopup.style.top = `${top}px`;

        orchestratorPopup.style.visibility = 'visible';
        orchestratorPopup.style.opacity = '1';
    }

    function hideOrchestratorPopup() {
        orchestratorPopup.style.opacity = '0';
        orchestratorPopup.style.visibility = 'hidden';
        setTimeout(() => {
            orchestratorPopup.style.display = 'none';
        }, 200);
    }

    let selectedTextForNotFound = ''; // Зберігаємо виділений текст для повідомлення "не знайдено"

    document.addEventListener('mouseup', (event) => {
        const selection = window.getSelection();
        const selectedText = selection.toString().trim(); 
        selectedTextForNotFound = selectedText; // Зберігаємо виділений текст

        if (selectedText.length > 0 && !orchestratorPopup.contains(event.target)) {
            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect(); 
            
            const normalizedSelectedText = selectedText.toLowerCase();
            
            // Перевіряємо точне співпадіння
            if (knowledgeBase[normalizedSelectedText]) {
                showOrchestratorPopup(normalizedSelectedText, rect);
            } else {
                // Якщо точного співпадіння немає, шукаємо за підрядком
                let foundPartial = false;
                for (const key in knowledgeBase) {
                    if (key.length > 2 && normalizedSelectedText.includes(key)) { // Перевірка, чи виділений текст містить ключ
                        showOrchestratorPopup(key, rect); // Показуємо попап для знайденого ключа
                        foundPartial = true;
                        break; 
                    }
                }
                if (!foundPartial) {
                    // Якщо нічого не знайдено, все одно показуємо попап, але з повідомленням "не знайдено"
                    // Встановлюємо заголовок попапа на оригінальний виділений текст
                    showOrchestratorPopup(normalizedSelectedText, rect); 
                }
            }
        } else if (!orchestratorPopup.contains(event.target) && event.target !== popupCloseBtn) {
            hideOrchestratorPopup();
        }
    });

    popupCloseBtn.addEventListener('click', hideOrchestratorPopup);

    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
            hideOrchestratorPopup();
        }
    });
});
    </script>
</body>
</html>